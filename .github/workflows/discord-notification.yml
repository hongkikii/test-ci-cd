name: Discord Notification

on:
  pull_request:
    types: [opened, submitted, reopened]
  push:
    branches:
      - main

jobs:
  PR:
    runs-on: ubuntu-latest
    steps:
      - run: >
          DESCRIPTION=${{ toJson(github.event.pull_request.body) }};
          echo "DESCRIPTION=$DESCRIPTION" >> $GITHUB_ENV
      - env:
          DATA: >
            {
              "username": ${{ toJson(github.event.sender.login) }},
              "avatar_url": ${{ toJson(github.event.sender.avatar_url) }},
              "embeds": [
                {
                  "title": ${{ toJson(github.event.pull_request.title) }},
                  "description": "[PR]새로운 PR이 도착 💨 \n\n${{ env.DESCRIPTION }}",
                  "url": ${{ toJson(github.event.pull_request.html_url) }},
                  "color": 6847432
                }
              ]
            }
        run: >
          curl -X
          POST -H 'Content-type:application/json'
          -d "$DATA"
          ${{ secrets.DISCORD_WEBHOOK_URL }}
